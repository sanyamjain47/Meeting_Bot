Add support for mongodb
Make the code more organized